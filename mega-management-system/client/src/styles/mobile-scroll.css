/* Mobile Scroll Optimization Styles - Optimized for Consistent Smooth Scrolling */

/* 
  This file contains carefully tuned optimizations for smooth scrolling on mobile devices.
  Updated to remove performance-killing rules and ensure consistent smooth scrolling.
*/

/* Global smooth scrolling setup */
html {
  scroll-behavior: smooth;
  -webkit-text-size-adjust: 100%;
  height: 100%;
}

body {
  /* Enable momentum scrolling on iOS */
  -webkit-overflow-scrolling: touch;
  /* Prevent overscroll bounce on the whole page */
  overscroll-behavior-y: contain;
  /* Allow only vertical scrolling */
  touch-action: pan-y;
  /* Remove tap highlight */
  -webkit-tap-highlight-color: transparent;
  /* Ensure body takes full height */
  min-height: 100vh;
  min-height: -webkit-fill-available;
}

/* Apply smooth scrolling to all scrollable containers */
*,
*::before,
*::after {
  /* Remove tap highlight on all elements */
  -webkit-tap-highlight-color: transparent;
  /* Smooth font rendering */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Scrollable container optimizations - NO will-change to prevent performance issues */
.scrollable,
[class*="overflow-y-auto"],
[class*="overflow-auto"],
[class*="overflow-scroll"] {
  /* Enable momentum scrolling on iOS */
  -webkit-overflow-scrolling: touch;
  /* Contain overscroll within the element */
  overscroll-behavior-y: contain;
  /* Smooth scrolling */
  scroll-behavior: smooth;
}

/* Fixed and sticky elements optimization - Minimal GPU usage */
.fixed,
.sticky,
[class*="fixed"],
[class*="sticky"] {
  /* GPU acceleration only for fixed/sticky - critical for smooth scrolling */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

/* Mobile-specific optimizations */
@media (max-width: 768px) {
  /* Root container optimization */
  #root {
    min-height: 100vh;
    min-height: -webkit-fill-available;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  /* Main content area - Primary scroll container */
  main {
    /* Enable momentum scrolling on iOS */
    -webkit-overflow-scrolling: touch;
    /* Contain overscroll within the element */
    overscroll-behavior-y: contain;
    /* Smooth scrolling */
    scroll-behavior: smooth;
    /* GPU acceleration for main scroll container */
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    /* CSS containment for better performance */
    contain: layout style paint;
    /* Prevent pull-to-refresh interference */
    touch-action: pan-y;
  }

  /* All scrollable containers on mobile */
  .overflow-y-auto,
  .overflow-auto,
  .overflow-scroll,
  .overflow-x-auto {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
    scroll-behavior: smooth;
    /* Apply GPU acceleration to scroll containers */
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    /* Use CSS containment */
    contain: layout style paint;
  }

  /* Optimize fixed navigation on mobile */
  nav[class*="fixed"],
  header[class*="fixed"],
  footer[class*="fixed"] {
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
  }

  /* Modal and dialog optimizations */
  [role="dialog"],
  .modal,
  .dialog {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
    scroll-behavior: smooth;
  }

  /* Optimize media elements */
  img,
  video,
  iframe {
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
  }

  /* Optimize animations for better scroll performance */
  @media (hover: none) and (pointer: coarse) {
    /* Reduce animation complexity during scroll on touch devices */
    .card-hover,
    .hover-effect {
      transition-duration: 0.15s;
    }
  }

  /* Optimize grids and flex containers */
  .grid,
  [class*="grid-cols"],
  .flex {
    contain: layout style paint;
  }
}

/* Touch device specific optimizations */
@media (hover: none) and (pointer: coarse) {
  /* Prevent accidental zoom on double tap */
  button,
  input,
  select,
  textarea,
  a {
    touch-action: manipulation;
  }

  /* Optimize button tap response */
  button,
  [role="button"] {
    cursor: pointer;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
    touch-action: manipulation;
  }

  /* Prevent iOS zoom on input focus */
  input,
  select,
  textarea {
    font-size: max(16px, 1rem);
  }
}

/* Utility classes for smooth scrolling */
.scroll-smooth {
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
}

.scroll-momentum {
  -webkit-overflow-scrolling: touch;
  overscroll-behavior-y: contain;
}

.scroll-optimized {
  -webkit-overflow-scrolling: touch;
  overscroll-behavior-y: contain;
  scroll-behavior: smooth;
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  contain: layout style paint;
}

.gpu-accelerated {
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

/* iOS Safari specific fixes - Optimized approach */
@supports (-webkit-touch-callout: none) {
  /* iOS Safari */
  html {
    height: 100%;
    overflow: hidden;
  }

  body {
    height: 100%;
    overflow: hidden;
  }

  #root {
    height: 100%;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: contain;
  }

  main {
    /* Account for mobile bottom nav */
    min-height: calc(100vh - 80px);
    padding-bottom: env(safe-area-inset-bottom);
  }

  /* Fix for iOS address bar height changes */
  @media (max-width: 768px) {
    main {
      min-height: -webkit-fill-available;
    }
  }
}

/* Prevent text selection during rapid scrolling */
@media (max-width: 768px) {
  * {
    -webkit-user-select: none;
    user-select: none;
  }

  /* Re-enable for content */
  p, span, li, td, th, h1, h2, h3, h4, h5, h6,
  input, textarea, [contenteditable] {
    -webkit-user-select: text;
    user-select: text;
  }

  /* Re-enable for interactive elements */
  button, a, label {
    -webkit-user-select: none;
    user-select: none;
  }
}

/* High refresh rate display optimization */
@media (prefers-reduced-motion: no-preference) {
  @media (max-width: 768px) {
    * {
      scroll-behavior: smooth;
    }
  }
}

/* Respect reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Optimize table scrolling on mobile */
@media (max-width: 768px) {
  table {
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-x: contain;
    white-space: nowrap;
  }

  tbody, thead {
    display: table;
    width: 100%;
  }
}

/* Prevent pull-to-refresh in PWA mode */
@media (display-mode: standalone) {
  body {
    overscroll-behavior-y: none;
  }
}
